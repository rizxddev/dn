<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXDOWN // ALL IN ONE DOWNLOADER</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.net.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Syncopate:wght@400;700&family=Inter:wght@300;400;600;900&display=swap');

        :root {
            --neon: #00f2ff;
            --purple: #bc13fe;
            --dark: #000000;
        }

        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            background: var(--dark);
            color: #fff;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }

        .font-cyber { font-family: 'Syncopate', sans-serif; }

        #vanta-canvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -1;
        }

        #cursor-glow {
            position: fixed;
            width: 500px; height: 500px;
            background: radial-gradient(circle, rgba(0, 242, 255, 0.07) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 0;
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }

        .glitch {
            font-size: 7vw;
            font-weight: 900;
            position: relative;
            color: #fff;
            letter-spacing: -3px;
            text-transform: uppercase;
        }
        .glitch::before, .glitch::after {
            content: attr(data-text);
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
        }
        .glitch::before {
            left: 2px;
            text-shadow: -2px 0 var(--neon);
            clip: rect(44px, 450px, 56px, 0);
            animation: glitch-anim 5s infinite linear alternate-reverse;
        }
        .glitch::after {
            left: -2px;
            text-shadow: -2px 0 var(--purple);
            clip: rect(44px, 450px, 56px, 0);
            animation: glitch-anim2 5s infinite linear alternate-reverse;
        }

        @keyframes glitch-anim { 0% { clip: rect(31px, 9999px, 94px, 0); } 100% { clip: rect(70px, 9999px, 71px, 0); } }
        @keyframes glitch-anim2 { 0% { clip: rect(65px, 9999px, 100px, 0); } 100% { clip: rect(10px, 9999px, 20px, 0); } }

        .cyber-box {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .cyber-box:focus-within {
            border-color: var(--neon);
            box-shadow: 0 0 30px rgba(0, 242, 255, 0.15);
        }

        .btn-execute {
            background: #fff;
            color: #000;
            font-family: 'Syncopate';
            font-weight: 700;
            clip-path: polygon(0 0, 95% 0, 100% 25%, 100% 100%, 5% 100%, 0 75%);
            transition: all 0.3s;
        }
        .btn-execute:hover {
            background: var(--neon);
            box-shadow: 0 0 40px var(--neon);
            transform: translateY(-2px);
            letter-spacing: 5px;
        }

        .terminal-text {
            font-family: 'Courier New', monospace;
            font-size: 10px;
            color: var(--neon);
            height: 60px;
            overflow-y: hidden;
            opacity: 0.6;
        }

        .scanline {
            position: fixed; top: 0; left: 0; width: 100%; height: 2px;
            background: rgba(0, 242, 255, 0.03);
            z-index: 100; pointer-events: none;
            animation: scan 8s linear infinite;
        }
        @keyframes scan { 0% { top: 0%; } 100% { top: 100%; } }

        .platform-icon {
            transition: all 0.4s;
            filter: grayscale(1);
            opacity: 0.4;
        }
        .platform-card:hover .platform-icon {
            filter: grayscale(0);
            opacity: 1;
            transform: scale(1.2);
            drop-shadow: 0 0 10px var(--neon);
        }

        @keyframes slide {
            from { transform: translateX(-100%); }
            to { transform: translateX(200%); }
        }
    </style>
</head>
<body>

    <div id="vanta-canvas"></div>
    <div id="cursor-glow"></div>
    <div class="scanline"></div>

    <nav class="p-8 md:p-12 flex justify-between items-center relative z-20">
        <div class="font-cyber font-bold text-2xl tracking-[0.4em] text-white">
            NEX<span class="text-[var(--neon)]">DOWN</span>
        </div>
        <div class="flex items-center gap-6">
            <div id="clock" class="font-cyber text-[10px] tracking-widest text-slate-500 hidden md:block">00:00:00</div>
            <div class="h-2 w-2 bg-green-500 rounded-full animate-pulse shadow-[0_0_10px_#22c55e]"></div>
        </div>
    </nav>

    <main class="container mx-auto px-8 relative z-20">
        <div class="max-w-6xl mx-auto">
            
            <div class="mb-10 animate__animated animate__fadeIn">
                <p class="text-[var(--neon)] font-cyber text-[10px] mb-4 tracking-[0.8em]">PROTOCOL IDENTIFIED: EXTRACTION MODE</p>
                <h1 class="glitch font-cyber" data-text="MEDIA_CORE">MEDIA CORE</h1>
                
                <div class="mt-8 flex flex-wrap gap-8 items-center border-l-2 border-[var(--neon)] pl-6 py-2 opacity-80">
                    <span class="font-cyber text-[9px] tracking-[0.3em] text-slate-500">DOWNLOADER FOR:</span>
                    <div class="flex gap-6 items-center">
                        <div class="platform-card group flex flex-col items-center">
                            <i data-lucide="music-2" class="platform-icon text-white w-5 h-5"></i>
                            <span class="text-[7px] font-cyber mt-2 opacity-0 group-hover:opacity-100 text-[var(--neon)] transition-opacity">TIKTOK</span>
                        </div>
                        <div class="platform-card group flex flex-col items-center">
                            <i data-lucide="youtube" class="platform-icon text-white w-5 h-5"></i>
                            <span class="text-[7px] font-cyber mt-2 opacity-0 group-hover:opacity-100 text-[var(--neon)] transition-opacity">YOUTUBE</span>
                        </div>
                        <div class="platform-card group flex flex-col items-center">
                            <i data-lucide="facebook" class="platform-icon text-white w-5 h-5"></i>
                            <span class="text-[7px] font-cyber mt-2 opacity-0 group-hover:opacity-100 text-[var(--neon)] transition-opacity">FACEBOOK</span>
                        </div>
                        <div class="platform-card group flex flex-col items-center">
                            <i data-lucide="instagram" class="platform-icon text-white w-5 h-5"></i>
                            <span class="text-[7px] font-cyber mt-2 opacity-0 group-hover:opacity-100 text-[var(--neon)] transition-opacity">INSTAGRAM</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-4 gap-4 animate__animated animate__fadeInUp">
                <div class="lg:col-span-3 cyber-box p-1 relative">
                    <input type="text" id="urlInput" 
                        onmouseenter="playHover()"
                        placeholder="// PASTE_SOURCE_URL_HERE..." 
                        class="w-full bg-transparent p-6 outline-none font-cyber text-sm tracking-widest text-white placeholder:text-slate-700">
                </div>
                
                <div class="cyber-box p-1">
                    <select id="formatSelect" onmouseenter="playHover()" class="w-full h-full bg-transparent p-4 outline-none font-cyber text-[10px] tracking-widest text-white cursor-pointer bg-black">
                         <option value="1080">MP4 // 1080P</option>
                        <option value="720">MP4 // 720P</option>
                         <option value="480">MP4 // 480P</option>
                        <option value="360">MP4 // 360P</option>
                    </select>
                </div>

                <div class="lg:col-span-4 mt-2">
                    <button onclick="handleDownload()" id="btnDownload" onmouseenter="playHover()"
                        class="w-full btn-execute py-8 text-xs tracking-[1.5em] flex justify-center items-center group">
                        START <i data-lucide="zap" class="ml-4 w-4 h-4 fill-current"></i>
                    </button>
                </div>

                <div class="lg:col-span-4 cyber-box p-4 opacity-70">
                    <div class="flex justify-between items-center mb-3 border-b border-white/5 pb-2">
                        <span class="text-[8px] font-cyber text-slate-500 tracking-widest uppercase">Kernel Log Output</span>
                        <span class="text-[8px] font-cyber text-cyan-500 animate-pulse">LISTENING...</span>
                    </div>
                    <div id="terminal" class="terminal-text">
                        > SYSTEM READY...<br>
                        > WAITING FOR ENCRYPTED URL INPUT...
                    </div>
                </div>
            </div>

            <div id="loading" class="hidden mt-12 text-center">
                <div class="flex flex-col items-center gap-4">
                    <div class="w-48 h-[1px] bg-slate-800 relative overflow-hidden">
                        <div class="absolute inset-0 bg-[var(--neon)] w-1/2 animate-[slide_1s_infinite]"></div>
                    </div>
                    <p class="font-cyber text-[9px] tracking-[1em] text-[var(--neon)] animate-pulse">BYPASSING FIREWALL...</p>
                </div>
            </div>

            <div id="resultArea" class="mt-20 grid grid-cols-1 md:grid-cols-2 gap-8 pb-32">
            </div>
        </div>
    </main>

    <footer class="fixed bottom-0 left-0 w-full p-6 border-t border-white/5 bg-black/50 backdrop-blur-xl z-30 flex justify-between items-center px-10">
        <div class="text-[8px] font-cyber text-slate-600 tracking-widest">Â© 2026 NEXDOWN CORE TECH // ALL RIGHTS RESERVED</div>
        <div class="text-[8px] font-cyber text-slate-600 tracking-widest hidden md:block italic">"SECURITY IS JUST AN ILLUSION"</div>
    </footer>

    <script>
        lucide.createIcons();

        const hoverSfx = new Audio('data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YT1vT19vT19vT19vT19vT19vT19vT19vT19vT19vT19vT19vT19vT19vT19vT19vT19vT19vT19vT19vT19vT19vT19vT19v');
        const clickSfx = new Audio('data:audio/wav;base64,UklGRjIAAABXQVZFZm10IBAAAAABAAEAIlYAAESsAAACABAAZGF0YQIAAABvbw==');
        
        function playHover() { hoverSfx.currentTime = 0; hoverSfx.volume = 0.1; hoverSfx.play(); }
        function playClick() { clickSfx.play(); }

        VANTA.NET({
            el: "#vanta-canvas",
            mouseControls: true, touchControls: true, gyroControls: false,
            minHeight: 200.00, minWidth: 200.00,
            scale: 1.00, scaleMobile: 1.00,
            color: 0x00f2ff, backgroundColor: 0x0,
            points: 10.00, maxDistance: 25.00, spacing: 17.00
        });

        const glow = document.getElementById('cursor-glow');
        document.addEventListener('mousemove', (e) => {
            glow.style.left = e.clientX + 'px';
            glow.style.top = e.clientY + 'px';
        });

        setInterval(() => {
            const now = new Date();
            document.getElementById('clock').innerText = now.getHours().toString().padStart(2, '0') + ":" + 
                now.getMinutes().toString().padStart(2, '0') + ":" + now.getSeconds().toString().padStart(2, '0');
        }, 1000);

        const terminal = document.getElementById('terminal');
        const logs = [
            "SCANNING SOURCE PROTOCOLS...",
            "INJECTING QUANTUM SCRAPER...",
            "HANDSHAKING WITH EXTERNAL API...",
            "DECRYPTING BUFFER STREAM...",
            "BYPASSING BOT DETECTION v4...",
            "EXTRACTION COMPLETE: FINALIZING DATA."
        ];

        function addLog(text) {
            const time = new Date().toLocaleTimeString();
            terminal.innerHTML = `> [${time}] ${text}<br>` + terminal.innerHTML;
        }

        function forceDownload(url, title) {
    if (!url || url === "#") {
        addLog("ERROR: INVALID DATA STREAM");
        return;
    }

    playClick();
    addLog("ROUTING THROUGH QUANTUM PROXY...");

    // 1. Sanitasi judul lebih ketat untuk menghindari error URL
    // Menghapus karakter non-alphanumeric agar filename aman bagi OS (Windows/Linux/Mac)
    const safeName = title.replace(/[^a-z0-9]/gi, '_').toLowerCase().substring(0, 50);
    
    // 2. Gunakan URLSearchParams untuk encoding yang lebih rapi
    const params = new URLSearchParams({
        url: url,
        filename: safeName
    });
    
    const proxyUrl = `/api/proxy?${params.toString()}`;
    
    addLog("INJECTING STREAM TO LOCAL DISK...");
    
    // 3. Trigger Download
    // Menggunakan window.location.href adalah cara tercepat untuk bypass CORS via proxy
    window.location.href = proxyUrl;

    // Log sukses setelah jeda singkat
    setTimeout(() => {
        addLog("PROTOCOL: DOWNLOAD_STARTED_SUCCESSFULLY");
    }, 1500);
}



                async function handleDownload() {
            playClick();
            const url = document.getElementById('urlInput').value;
            const format = document.getElementById('formatSelect').value;
            const resultArea = document.getElementById('resultArea');
            const loading = document.getElementById('loading');
            const btn = document.getElementById('btnDownload');

            if(!url) {
                addLog("ERROR: SOURCE URL IS MISSING");
                return;
            }

            btn.disabled = true;
            btn.innerHTML = "IN PROGRESS...";
            resultArea.innerHTML = '';
            loading.classList.remove('hidden');
            
            addLog(`INITIALIZING FETCH: ${url.substring(0, 20)}...`);

            let i = 0;
            const logInt = setInterval(() => {
                if(i < logs.length) addLog(logs[i++]);
                else clearInterval(logInt);
            }, 700);

            try {
                const response = await fetch('/api/download', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url, format })
                });
                const data = await response.json();

                if (data.success) {
                    addLog("DATA RETRIEVED: RENDERING UI COMPONENTS");
                    data.results.forEach(item => {
                        // FIX: Ambil URL dari properti 'url' (YT) atau 'video_file_url' (Sosmed lain)
                        const downloadLink = item.url || item.video_file_url;
                        const cleanTitle = (item.title || 'video').replace(/'/g, "");

                        resultArea.innerHTML += `
                            <div class="cyber-box p-6 animate__animated animate__fadeInUp relative overflow-hidden group">
                                <div class="absolute top-0 right-0 p-2 bg-[var(--neon)] text-black font-cyber text-[8px]">DOWNLOAD READY</div>
                                
                                <div class="flex flex-col gap-6">
                                    <div class="w-full aspect-video border border-white/10 overflow-hidden relative shadow-2xl bg-zinc-900">
                                        <img src="${item.thumb}" class="w-full h-full object-contain grayscale group-hover:grayscale-0 transition-all duration-1000">
                                    </div>

                                    <div class="flex-1 min-w-0">
                                        <h3 class="font-cyber text-[10px] tracking-widest text-white mb-4 leading-relaxed line-clamp-2 uppercase">
                                            ${item.title || 'UNKNOWN MEDIA OBJECT'}
                                        </h3>
                                        
                                        <button onclick="forceDownload('${downloadLink}', '${cleanTitle}')" 
                                           onmouseenter="playHover()"
                                           class="inline-block w-full border border-[var(--neon)] bg-[var(--neon)]/5 text-[var(--neon)] hover:bg-[var(--neon)] hover:text-black py-4 text-center font-cyber text-[9px] tracking-[0.4em] transition-all">
                                           START DOWNLOAD
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    lucide.createIcons();
                } else {
                    addLog(`FATAL ERROR: ${data.error}`);
                }
            } catch (err) {
                addLog("ERROR: SERVER RESPONSE TIMEOUT");
            } finally {
                clearInterval(logInt); // Hentikan interval log jika selesai
                loading.classList.add('hidden');
                btn.disabled = false;
                btn.innerHTML = `START <i data-lucide="zap" class="ml-4 w-4 h-4 fill-current"></i>`;
                lucide.createIcons();
            }
        }

    </script>
</body>
</html>
